---
title: "GruppenAufgaben"
author: "Gruppe 26"
date: "15 2 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Libraries einbinden

```{r libraries}
library(tidyverse)
```



## Aufgabe 1

Importieren Sie relevante Datensätze aus dem bereitgestellten tubcloud-Ordner. Listen sie zunächst in der Dokumentation auf, welche Dateien sie importieren.

```{r import data}
# Import Einzelteile
# Import all the relevant parts (T11, T14, T15, T16, T19, T20)

# read files with exotic delimiters in txt-files (T11, T16, T20) as string (for better performance)
einzelteil_t11_string <- read_file("Data/Einzelteil/Einzelteil_T11.txt")
einzelteil_t16_string <- read_file("Data/Einzelteil/Einzelteil_T16.txt")
einzelteil_t20_string <- read_file("Data/Einzelteil/Einzelteil_T20.txt")

# replace exotic delimiters between columns
einzelteil_t11_csv <- gsub("\t", ",", einzelteil_t11_string)
einzelteil_t16_csv <- gsub(" \\| \\| ", ",", einzelteil_t16_string)
einzelteil_t20_csv <- gsub(" \\| \\| ", ",", einzelteil_t20_string)

# replace exotic delimiters between rows
einzelteil_t11_csv <- gsub("", "\n", einzelteil_t11_csv)
einzelteil_t16_csv <- gsub("\t", "\n", einzelteil_t16_csv)
einzelteil_t20_csv <- gsub(" ", "\n", einzelteil_t20_csv)

# write data into one csv file, respectively
write(einzelteil_t11_csv, file = "Data/Einzelteil/Einzelteil_T11.csv")
write(einzelteil_t16_csv, file = "Data/Einzelteil/Einzelteil_T16.csv")
write(einzelteil_t20_csv, file = "Data/Einzelteil/Einzelteil_T20.csv")

# Import final csv-files. Import with utils package because the readr functions return parsing errors 
# and a lot of data is shown as NA even though there is data. The parsing error happens because the 
# data is split on different columns

# read csv, avoid parsing of ID column into Factor
t11 <- read.csv("Data/Einzelteil/Einzelteil_T11.csv", stringsAsFactors = FALSE)
t16 <- read.csv("Data/Einzelteil/Einzelteil_T16.csv", stringsAsFactors = FALSE)
t19 <- read.csv("Data/Einzelteil/Einzelteil_T19.csv", stringsAsFactors = FALSE)
t20 <- read.csv("Data/Einzelteil/Einzelteil_T20.csv", stringsAsFactors = FALSE)

# read csv2, avoid parsing of ID column into Factor
t14 <- read.csv2("Data/Einzelteil/Einzelteil_T14.csv", stringsAsFactors = FALSE)
t15 <- read.csv2("Data/Einzelteil/Einzelteil_T15.csv", stringsAsFactors = FALSE)

# Produktionsdatum_Origin_01011970 (in T11, T14, T19, T20) is an integer representing days since origin date
# Transform origin column into Class Date, use mutate to add Produktionsdatum_Origin_01011970 values to origin values
t11 %>% 
  mutate(Produktionsdatum = as.Date(origin, format = "%d-%m-%Y") + Produktionsdatum_Origin_01011970)
t14 %>% 
  mutate(Produktionsdatum = as.Date(origin, format = "%d-%m-%Y") + Produktionsdatum_Origin_01011970)
t19 %>% 
  mutate(Produktionsdatum = as.Date(origin, format = "%d-%m-%Y") + Produktionsdatum_Origin_01011970)
t20 %>% 
  mutate(Produktionsdatum = as.Date(origin, format = "%d-%m-%Y") + Produktionsdatum_Origin_01011970)

# Remove unnecessary columns
t11 <- t11 %>% select(-X1, -origin, -Produktionsdatum_Origin_01011970)
t14 <- t14 %>% select(-X, -X1, -origin, -Produktionsdatum_Origin_01011970)
t15 <- t15 %>% select(-X, -X1)
t16 <- t16 %>% select(-X1)
t19 <- t19 %>% select(-X, -X1, -origin, -Produktionsdatum_Origin_01011970)
t20 <- t20 %>% select(-X1, -origin, -Produktionsdatum_Origin_01011970)

# Split the three diferent parts of T15 and T16 into three data sets
t15_part1 <- filter(t15, !is.na(ID_T15.x)) 
t15_part2 <- filter(t15, !is.na(ID_T15.y))

t16_part1 <- filter(t16, !is.na(ID_T16.x)) 
t16_part2 <- filter(t16, !is.na(ID_T16.y))
t16_part3 <- filter(t16, !is.na(ID_T16))

# Remove empty column from each data set 
t15_part1 <- t15_part1[, c(-8:-21)] 
t15_part2 <- t15_part2[, c(-1:-7)]

t16_part1 <- t16_part1[, c(-8:-21)] 
t16_part2 <- t16_part2[, c(-1:-7, -15:-21)]
t16_part3 <- t16_part3[, c(-1:-14)]

# Rename column names to the same names for all parts of T15 and T16 data set respectively
colnames(t15_part2) <- c("ID_T15", "Produktionsdatum", "Herstellernummer","Werksnummer", "Fehlerhaft", "Fehlerhaft_Datum", "Fehlerhaft_Fahrleistung" )
colnames(t15_part1) <- colnames(t15_part2)

colnames(t16_part3) <- c("ID_T16", "Produktionsdatum", "Herstellernummer","Werksnummer", "Fehlerhaft", "Fehlerhaft_Datum", "Fehlerhaft_Fahrleistung" )
colnames(t16_part2) <- colnames(t16_part3)
colnames(t16_part1) <- colnames(t16_part3)

# Bind the three datasets into one dataset, respectively
t15 <- rbind(t15_part1, t15_part2)

t16 <- rbind(t16_part1, t16_part2, t16_part3)

# Produktionsdatum and Fehlerhaft_Datum into Class Date
t11$Produktionsdatum <- as.Date(t11$Produktionsdatum, format = "%Y-%m-%d")
t14$Produktionsdatum <- as.Date(t14$Produktionsdatum, format = "%Y-%m-%d")
t15$Produktionsdatum <- as.Date(t15$Produktionsdatum, format = "%Y-%m-%d")
t16$Produktionsdatum <- as.Date(t16$Produktionsdatum, format = "%Y-%m-%d")
t19$Produktionsdatum <- as.Date(t19$Produktionsdatum, format = "%Y-%m-%d")
t20$Produktionsdatum <- as.Date(t20$Produktionsdatum, format = "%Y-%m-%d")

t11$Fehlerhaft_Datum <- as.Date(t11$Fehlerhaft_Datum, format = "%Y-%m-%d")
t14$Fehlerhaft_Datum <- as.Date(t14$Fehlerhaft_Datum, format = "%Y-%m-%d")
t15$Fehlerhaft_Datum <- as.Date(t15$Fehlerhaft_Datum, format = "%Y-%m-%d")
t16$Fehlerhaft_Datum <- as.Date(t16$Fehlerhaft_Datum, format = "%Y-%m-%d")
t19$Fehlerhaft_Datum <- as.Date(t19$Fehlerhaft_Datum, format = "%Y-%m-%d")
t20$Fehlerhaft_Datum <- as.Date(t20$Fehlerhaft_Datum, format = "%Y-%m-%d")

# Move column Produktionsdatum to the last position in T15 and T16 in order to get the same structure for all datasets
t15 <- t15 %>% select(-Produktionsdatum, Produktionsdatum)
t16 <- t16 %>% select(-Produktionsdatum, Produktionsdatum)


#Import Komponenten


```

## Aufgabe 2

Bereiten Sie die für Ihre Aufgabe relevanten Daten nach den Prinzipien von tidy data auf und fügen Sie diese in einem einzigen Datensatz zusammen.

```{r tidy data}
# Tidy data
```

## Aufgabe 3

Entwickeln Sie eine Shiny-App welche folgende Kriterien erfüllt:
Alle verwendeten Packages müssen auf der aktuellen R-Version lauffähig sein.
Die Applikation muss ohne weitere Anpassungen aus dem Abgabeordner gestartet werden können. Es bietet sich an, dies vor Abgabe zu testen. Die Applikation soll sich nur auf einen einzelnen, von Ihnen erstellten Datensatz beziehen.
Das Layout der Applikation soll auf die Zielgruppe angepasst sein und der Unternehmensfarbe entsprechen. Die Farbe ihres Unternehmens ist TUB-Rot. Des Weiteren soll ein Logo in das Layout integriert werden. Es kann ein eigenes Logo erstellt werden, oder das Logo vom Fachgebiet Qualitätswissenschaft verwendet werden. Passen Sie die Schriftart ihrer Applikation nach Ihren wünschen an. Eine Anpassung ist obligatorisch.

```{r shiny app}
# Shiny Server
# Shiny App
```

## Aufgabe 4

Visualisieren Sie folgendes in der Applikation
a. Einen Graphen, der den zeitlichen Zulassungsverlauf der betroffenen Fahrzeuge in den Gemeinden darstellt. Verwenden Sie zusätzlich eine Heatmapdarstellung zur Visualisierung von Schadensschwerpunkten. Integrieren Sie Popups in die Kartendarstellung, die Informationen zu den zugelassenen Fahrzeugen enthalten.
b. Den Lieferweg (als Luftlinie) für ein betroffenes Bauteil, welches vom Benutzer ausgewählt werden kann.
c. Den Fahrzeughaltern soll es möglich sein, (bspw. über ein Suchfeld) anhand der Fahrzeug-ID zu überprüfen, ob ihr Auto betroffen ist.
d. Ihren zugrundeliegenden Datensatz als Tabelle, damit Sie Visualisiertes auch beweisen können. Denken Sie auch hier daran, nur die notwendigen Attribute anzuzeigen.

```{r plot data}
# a) Plot data 'zeitlichen Zulassungsverlauf'
ggplot()
# b) Plot data 'Lieferweg (als Luftlinie) für ein betroffenes Bauteil'
# c) ID tracker
# d) Print table
```

## Aufgabe 5

Dokumentieren Sie die Ergebnisse Ihrer Analyse in einer R Markdown Datei. Beschreiben Sie Ihren Datenanalyseprozess schrittweise und diskutieren Sie das Ergebnis anhand aussagekräftiger Graphiken aus Ihrer entwickelten App. Das Beschreiben Ihres Vorgehens dient der Nachvollziehbarkeit Ihrer Lösungsschritte. Falls es Probleme mit Ihrem R-Code gibt, kann durch die Dokumentation ein grundsätzlich richtiges Vorgehen anerkannt werden. Kommentieren Sie deshalb Ihren Code sorgfältig und beachten Sie den tidyverse Style-Guide. Erstellen Sie ein Inhaltsverzeichnis, welches im html-File eingeblendet wird und anklickbar ist. Folgende Gliederungspunkte sollen im Inhaltsverzeichnis mindestens aufgeführt werden:
Importieren der Daten Datenaufbereitung
Erstellen des finalen Datensatzes Auswertung
Ergebnis

```{r TOC}
# Table of Contents
```

## Aufgabe 6

Im Abgabeordner sollen folgende Dateien zu finden sein, XX ist mit der Gruppennummer zu ersetzen:
- Final_Data_Group_XX
- General_Tasks_Group_XX.rmd
- General_Tasks_Group_XX.html
- Case_Study_Group_XX.rmd
- Case_Study_Group_XX.html
- Case_study_App_XX.r